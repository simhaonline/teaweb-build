{$layout}

<!-- 检测配置是否有更新 begins -->
<div class="ui icon message warning" v-if="statusChanged">
    <i class="exclamation circle icon large"></i>
    代理服务已被修改，<a href="" v-on:click.prevent="restart()">点此重启后生效</a>
</div>

{$var "header"}
<script type="text/javascript" src="/_/@default/proxy/@global.js"></script>
{$end}
<!--  检测配置是否有更新 end -->

<!-- 错误信息 -->
<p class="ui message error" v-for="err in errs">
	发生错误：{{err}}
</p>

<div>
    {$template "/proxy/menu"}

    <!-- HTTPS 设置 -->
    <h3>HTTPS <a :href="'/proxy/ssl/update?serverId=' + server.id">修改</a></h3>

	<p class="ui message error" v-if="errorMessages.length > 0" v-for="error in errorMessages">
		发生错误：{{error}}
	</p>

	<p class="ui message warning" v-if="warningMessages.length > 0" v-for="warning in warningMessages">
		提醒：<span v-html="warning"></span>
	</p>

	<table class="ui table selectable definition">
        <tr>
            <td class="title">是否开启HTTPS</td>
            <td>
                <span class="ui label tiny green" v-if="server.ssl != null && server.ssl.on">已开启</span>
                <span class="ui label tiny" v-if="server.ssl == null || !server.ssl.on">未开启</span>
				&nbsp; <a href="" style="font-size: 12px" v-if="server.ssl != null && (!server.on || !server.ssl.on)" @click.prevent="startHttps()">快速启动</a><a href="" style="font-size: 12px" v-if="server.ssl != null && (server.on && server.ssl.on)" @click.prevent="shutdownHttps()">快速关闭</a>
            </td>
        </tr>
		<tr>
			<td>绑定网络地址<em>(listen)</em></td>
			<td colspan="2">
				<a class="disabled" v-if="server.ssl == null || server.ssl.listen == null || server.ssl.listen.length == 0">[还没有绑定网络地址]</a>
				<div v-if="server.ssl != null && server.ssl.listen != null">
					<span class="ui label small" v-for="listen in server.ssl.listen">{{listen}}</span>
				</div>
			</td>
		</tr>
		<tbody v-for="(cert,index) in certs">
			<tr>
				<td colspan="2" style="font-weight: normal;">证书#{{index+1}}<span v-if="cert.config.description.length > 0" class="grey">（{{cert.config.description}}）</span>：</td>
			</tr>
			<tr>
				<td>证书文件<em>(Certificate)</em></td>
				<td>
					<span v-if="cert.config.certFile.length > 0">{{cert.config.certFile}}</span>
					<p style="margin-top:0.4em;margin-bottom:0.5em" v-if="cert.config.certFile.length > 0">
						<a :href="'/proxy/ssl/downloadFile?serverId=' + server.id + '&file=' + cert.config.certFile" style="font-size:12px;">[下载]</a> &nbsp; <a :href="'/proxy/ssl/downloadFile?serverId=' + server.id + '&file=' + cert.config.certFile + '&view=1'" style="font-size:12px;" target="_blank" title="新窗口打开">[查看内容]</a>
					</p>
					<a class="disabled" v-if="cert.config.certFile.length == 0">[还没有上传证书文件]</a>

					<div class="info-box" v-if="cert.info.length > 0">
						<div class="ui field" v-for="(row, index) in cert.info" :style="{'font-style':(index == cert.info.length - 1) ? 'italic':''}">
							<span :style="{'padding-left':(index * 20) + 'px' }"></span>{{row.subject}}
							<span v-if="index == cert.info.length - 1" style="font-style: normal;"><br/>有效期：{{row.before}} - {{row.after}}</span>
						</div>
					</div>
				</td>
			</tr>
			<tr>
				<td>密钥文件<em>(Private Key)</em></td>
				<td>
					<span v-if="cert.config.keyFile.length > 0">{{cert.config.keyFile}}</span>
					<p style="margin-top:0.4em" v-if="cert.config.keyFile.length > 0">
						<a :href="'/proxy/ssl/downloadFile?serverId=' + server.id + '&file=' + cert.config.keyFile" style="font-size:12px;">[下载]</a> &nbsp; <a :href="'/proxy/ssl/downloadFile?serverId=' + server.id + '&file=' + cert.config.keyFile + '&view=1'" style="font-size:12px;" target="_blank" title="新窗口打开">[查看内容]</a>
					</p>
					<a class="disabled" v-if="cert.config.keyFile.length == 0">[还没有上传密钥文件]</a>
				</td>
			</tr>
		</tbody>
		<tr v-if="certs.length == 0">
			<td>证书和密钥</td>
			<td>还没有上传证书和密钥</td>
		</tr>
		<tr>
			<td>TLS最低版本</td>
			<td>
				<span v-if="server.ssl == null" class="disabled">还没有设置</span>
				<span v-if="server.ssl != null">{{minVersion}}</span>
			</td>
		</tr>
		<tr>
			<td>加密算法套件<em>(CipherSuites)</em></td>
			<td>
				<span v-if="server.ssl == null || server.ssl.cipherSuites == null || server.ssl.cipherSuites.length == 0" class="disabled">使用默认的算法套件。</span>
				<div v-if="server.ssl != null && server.ssl.cipherSuites != null && server.ssl.cipherSuites.length > 0">
					<span class="ui label tiny" v-for="cipherSuite in server.ssl.cipherSuites" v-html="formatCipherSuite(cipherSuite)"></span>
				</div>
			</td>
		</tr>
		<tr>
			<td>开启HSTS</td>
			<td>
				<span v-if="server.ssl != null && server.ssl.hsts" class="green">已开启</span>
				<span v-if="server.ssl == null || !server.ssl.hsts" class="disabled">未开启</span>
			</td>
		</tr>
    </table>
</div>